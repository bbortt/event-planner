plugins {
    id "java"
    id "org.springframework.boot"
    id "com.github.node-gradle.node"
    id "org.flywaydb.flyway"
}

group = "io.github.bbortt.event.planner.backend"
description = "Event Planning Tool - Monolithic Backend."

defaultTasks "bootRun"

springBoot {
    mainClassName = "io.github.bbortt.event.planner.EventPlannerApp"
}

dependencies {
    implementation "org.flywaydb:flyway-core"
}

configurations{
    all {
        resolutionStrategy {
            // Inherited version from Spring Boot can't be used because of regressions:
            // To be removed as soon as spring-boot use the same version
            force 'org.flywaydb:flyway-core:6.5.1'
        }
    }
}

task flywayCleanIntegrationTest(type: org.flywaydb.gradle.task.FlywayCleanTask) {
    flyway {
        url = "${flyway_it_jdbc_url}"
        user = "${flyway_it_user}"
        password = "${flyway_it_password}"
    }
}

integrationTest.dependsOn flywayCleanIntegrationTest
