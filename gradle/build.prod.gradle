clean.doFirst {
    delete "$rootDir/node_modules"
}

// --- General Configuration ---
node {
    version = "16.15.0"
    npmVersion = "8.5.5"
    npmInstallCommand = "ci"
}

if (project.hasProperty("nodeInstall")) {
    node {
        download = true
    }
}

// --- Frontend Build ---
task flow(type: NpmTask, dependsOn: "npmInstall") {
    args = ["run", "flow:check"]
}
test.dependsOn flow

task lint(type: NpmTask, dependsOn: "npmInstall") {
    args = ["run", "lint"]
}
test.dependsOn lint

task prettier(type: NpmTask, dependsOn: "npmInstall") {
    args = ["run", "prettier:check"]
}
test.dependsOn prettier

task jest(type: NpmTask, dependsOn: "npmInstall") {
    args = ["run", "test:ci"]
}
test.dependsOn jest

task webpack(type: NpmTask, dependsOn: "npmInstall") {
    args = ["run", "fullbuild"]
}
processResources.dependsOn webpack
