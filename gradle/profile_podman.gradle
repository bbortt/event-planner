tasks.withType(Test).configureEach {
    doFirst {
        OperatingSystem os = org.gradle.nativeplatform.platform.internal.DefaultNativePlatform.currentOperatingSystem;
        if (os.isLinux()) {
            def uid = ["id", "-u"].execute().text.trim()
            environment "DOCKER_HOST", "unix:///run/user/$uid/podman/podman.sock"
        } else if (os.isMacOsX()) {
            environment "DOCKER_HOST", "unix:///tmp/podman.sock"
        }
        environment "TESTCONTAINERS_RYUK_DISABLED", "true"
    }
}
